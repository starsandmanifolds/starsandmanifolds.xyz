@import "tailwindcss";
@import "@catppuccin/tailwindcss/mocha.css";

/* Self-hosted fonts - Latin subset only for smaller bundle */

/* Inter - Primary sans-serif font */
@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-display: swap;
  font-weight: 400;
  src: url('/fonts/inter-latin-400-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-display: swap;
  font-weight: 500;
  src: url('/fonts/inter-latin-500-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-display: swap;
  font-weight: 600;
  src: url('/fonts/inter-latin-600-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-display: swap;
  font-weight: 700;
  src: url('/fonts/inter-latin-700-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

/* Fira Code - Monospace font for code blocks */
@font-face {
  font-family: 'Fira Code';
  font-style: normal;
  font-display: swap;
  font-weight: 400;
  src: url('/fonts/fira-code-latin-400-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

/* Dancing Script - Decorative font */
@font-face {
  font-family: 'Dancing Script';
  font-style: normal;
  font-display: swap;
  font-weight: 700;
  src: url('/fonts/dancing-script-latin-700-normal.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

/* Light theme (Latte) - applied when OS prefers light color scheme */
@media (prefers-color-scheme: light) {
  :root {
    --catppuccin-color-rosewater: #dc8a78;
    --catppuccin-color-flamingo: #dd7878;
    --catppuccin-color-pink: #ea76cb;
    --catppuccin-color-mauve: #8839ef;
    --catppuccin-color-red: #d20f39;
    --catppuccin-color-maroon: #e64553;
    --catppuccin-color-peach: #fe640b;
    --catppuccin-color-yellow: #df8e1d;
    --catppuccin-color-green: #40a02b;
    --catppuccin-color-teal: #179299;
    --catppuccin-color-sky: #04a5e5;
    --catppuccin-color-sapphire: #209fb5;
    --catppuccin-color-blue: #1e66f5;
    --catppuccin-color-lavender: #7287fd;
    --catppuccin-color-text: #4c4f69;
    --catppuccin-color-subtext1: #5c5f77;
    --catppuccin-color-subtext0: #6c6f85;
    --catppuccin-color-overlay2: #7c7f93;
    --catppuccin-color-overlay1: #8c8fa1;
    --catppuccin-color-overlay0: #9ca0b0;
    --catppuccin-color-surface2: #acb0be;
    --catppuccin-color-surface1: #bcc0cc;
    --catppuccin-color-surface0: #ccd0da;
    --catppuccin-color-base: #eff1f5;
    --catppuccin-color-mantle: #e6e9ef;
    --catppuccin-color-crust: #dce0e8;
  }
}

@theme {
  --font-family-sans:
    Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    sans-serif;
  --font-family-mono:
    "Fira Code", "JetBrains Mono", Consolas, Monaco, monospace;
  --font-family-decorative: "Dancing Script", cursive;
}

/* Define utility classes for custom fonts in Tailwind CSS v4 */
@utility font-decorative {
  font-family: var(--font-family-decorative);
}

@layer base {
  /* Smooth transitions for theme changes */
  html {
    @apply transition-colors duration-300;
    /* Always show vertical scrollbar to prevent layout shift */
    overflow-y: scroll;
    /* Respect OS color scheme preference */
    color-scheme: light dark;
  }

  /* Base body styling - uses Catppuccin theme colors (Latte/Mocha based on OS preference) */
  body {
    background-color: var(--color-ctp-base);
    color: var(--color-ctp-text);
    position: relative;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Selection colors - Catppuccin Mauve */
  ::selection {
    @apply bg-ctp-mauve text-ctp-crust;
  }
}

/* Typography/Prose Styles - Catppuccin Theme (Latte light / Mocha dark) */
.prose {
  color: var(--color-ctp-text);
  max-width: none;
  line-height: 1.75;
}

.prose h1,
.prose h2,
.prose h3,
.prose h4 {
  scroll-margin-top: 5rem;
}

.prose h1 {
  color: var(--color-ctp-text);
  font-weight: 800;
  font-size: 2.25em;
  margin-top: 0;
  margin-bottom: 0.8888889em;
  line-height: 1.1111111;
}

.prose h2 {
  color: var(--color-ctp-text);
  font-weight: 700;
  font-size: 1.5em;
  margin-top: 2em;
  margin-bottom: 1em;
  line-height: 1.3333333;
}

.prose h3 {
  color: var(--color-ctp-text);
  font-weight: 600;
  font-size: 1.25em;
  margin-top: 1.6em;
  margin-bottom: 0.6em;
  line-height: 1.6;
}

.prose h4 {
  color: var(--color-ctp-text);
  font-weight: 600;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  line-height: 1.5;
}

.prose p {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
}

.prose a {
  color: var(--color-ctp-mauve);
  text-decoration: underline;
  font-weight: 500;
}

.prose a:hover {
  color: var(--color-ctp-pink);
}

.prose strong {
  color: var(--color-ctp-text);
  font-weight: 600;
}

.prose em {
  font-style: italic;
}

.prose code {
  color: var(--color-ctp-text);
  background-color: var(--color-ctp-surface0);
  padding: 0.2em 0.4em;
  border-radius: 0.25rem;
  font-size: 0.875em;
  font-weight: 400;
  font-family: "Fira Code", "JetBrains Mono", Consolas, Monaco, monospace;
  font-variant-ligatures: common-ligatures;
  font-feature-settings:
    "liga" 1,
    "calt" 1;
  /* Allow long inline code to wrap on mobile */
  overflow-wrap: break-word;
  word-break: break-word;
}

.prose ul {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  padding-left: 1.625em;
}

.prose ol {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  padding-left: 1.625em;
  list-style-type: decimal;
}

.prose li {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose nav li {
  margin-top: 0;
  margin-bottom: 0;
}

.prose nav ul {
  margin-top: 0;
  margin-bottom: 0;
}

.prose .footnotes {
  margin-top: 2em;
  font-size: 0.875em;
  color: var(--color-ctp-subtext0);
}

.prose .footnotes ol {
  list-style-type: decimal;
}

.prose blockquote {
  font-weight: 500;
  font-style: italic;
  color: var(--color-ctp-subtext1);
  border-left-width: 0.25rem;
  border-left-color: var(--color-ctp-surface1);
  quotes: "\201C" "\201D" "\2018" "\2019";
  margin-top: 1.6em;
  margin-bottom: 1.6em;
  padding-left: 1em;
}

/* Code block styling - base styles only, colors handled by Shiki rules below */
.prose pre {
  @apply rounded-lg my-6 p-0 overflow-hidden;
}

.prose pre code {
  @apply block p-4 overflow-x-auto text-sm bg-transparent;
  font-family:
    "Fira Code", "JetBrains Mono", Consolas, Monaco, monospace !important;
  font-variant-ligatures: common-ligatures !important;
  font-feature-settings:
    "liga" 1,
    "calt" 1 !important;
}

/* Shiki dual-theme support
 * With defaultColor: false, Shiki outputs NO inline colors - only CSS variables.
 * We use these variables directly, switching based on OS color scheme preference.
 * No !important needed since there are no inline styles to override.
 *
 * Theme choices for WCAG AA compliance:
 * - Dark: catppuccin-mocha (good contrast against dark backgrounds)
 * - Light: catppuccin-latte with 13 colorReplacements for WCAG AA (4.5:1)
 */
.shiki {
  background-color: var(--shiki-dark-bg);
}

.shiki span {
  color: var(--shiki-dark);
}

@media (prefers-color-scheme: light) {
  .shiki {
    background-color: var(--shiki-light-bg);
  }

  .shiki span {
    color: var(--shiki-light);
  }
}

.prose .shiki {
  @apply rounded-lg m-0;
}

.prose .shiki code {
  @apply bg-transparent;
  font-family:
    "Fira Code", "JetBrains Mono", Consolas, Monaco, monospace !important;
  font-variant-ligatures: common-ligatures !important;
  font-feature-settings:
    "liga" 1,
    "calt" 1 !important;
}

/* KaTeX math styling */
.prose .katex {
  color: var(--color-ctp-text);
  font-size: 1.1em;
}

.prose .katex-display {
  @apply my-6;
}

/* Math block background */
.prose .katex-display > .katex {
  @apply bg-ctp-mantle p-4 rounded-lg;
}

/* Mermaid diagram styling */

/* Hide raw mermaid code until rendered (prevents FOUC) */
pre.mermaid:not([data-processed="true"]) {
  visibility: hidden;
  height: 0;
  overflow: hidden;
}

.mermaid-container {
  @apply overflow-x-auto;
}

.mermaid-diagram {
  @apply max-w-full h-auto mx-auto block;
}

/* Mermaid dark mode overrides - SVGs are generated with Latte (light) colors,
 * so we override them for dark mode using Catppuccin Mocha palette.
 * The SVG has inline fill/stroke attributes and an embedded <style> block,
 * so we need high-specificity selectors with !important to override. */
@media (prefers-color-scheme: dark) {
  .mermaid-diagram {
    /* Actor boxes (rect elements with inline fill/stroke) */
    & rect.actor {
      fill: #313244 !important; /* surface0 */
      stroke: #9399b2 !important; /* overlay2 */
    }

    /* Actor text - target tspan inside text.actor */
    & text.actor,
    & text.actor > tspan {
      fill: #cdd6f4 !important; /* text */
    }

    /* Actor lifelines (vertical dashed lines) */
    & .actor-line,
    & line.actor-line {
      stroke: #89b4fa !important; /* blue */
    }

    /* Message arrows/lines */
    & .messageLine0,
    & .messageLine1,
    & line.messageLine0,
    & line.messageLine1,
    & path.messageLine0,
    & path.messageLine1 {
      stroke: #89b4fa !important; /* blue */
    }

    /* Message text labels */
    & .messageText,
    & text.messageText {
      fill: #cdd6f4 !important; /* text */
    }

    /* Arrowheads - target markers */
    & marker path,
    & defs marker path {
      fill: #89b4fa !important; /* blue */
      stroke: #89b4fa !important;
    }

    /* Loop boxes and labels */
    & .loopText,
    & .loopText > tspan,
    & text.loopText,
    & text.loopText > tspan {
      fill: #a6adc8 !important; /* subtext0 */
    }

    & .labelBox,
    & rect.labelBox {
      fill: #1e1e2e !important; /* base */
      stroke: #6c7086 !important; /* overlay0 */
    }

    & .labelText,
    & .labelText > tspan,
    & text.labelText,
    & text.labelText > tspan {
      fill: #cdd6f4 !important; /* text */
    }

    /* Note boxes */
    & .note,
    & rect.note {
      fill: #313244 !important; /* surface0 */
      stroke: #6c7086 !important; /* overlay0 */
    }

    & .noteText,
    & .noteText > tspan {
      fill: #cdd6f4 !important; /* text */
    }

    /* Activation boxes */
    & .activation0,
    & .activation1,
    & .activation2,
    & rect.activation0,
    & rect.activation1,
    & rect.activation2 {
      fill: #45475a !important; /* surface1 */
      stroke: #6c7086 !important; /* overlay0 */
    }

    /* General text fallback - all text and tspan elements */
    & text,
    & text > tspan,
    & tspan {
      fill: #cdd6f4 !important; /* text */
    }

    /* General line/path fallback for arrows */
    & line:not(.actor-line),
    & path:not([class]) {
      stroke: #89b4fa !important; /* blue */
    }
  }
}

/* Global ligature support for all code elements */
code,
pre,
.shiki,
.hljs {
  font-family:
    "Fira Code", "JetBrains Mono", Consolas, Monaco, monospace !important;
  font-variant-ligatures: common-ligatures !important;
  font-feature-settings:
    "liga" 1,
    "calt" 1 !important;
}

/* Catppuccin Divider */
.divider-space {
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    oklch(from var(--color-ctp-blue) l c h / 0.3) 15%,
    oklch(from var(--color-ctp-mauve) l c h / 0.3) 35%,
    oklch(from var(--color-ctp-pink) l c h / 0.3) 65%,
    oklch(from var(--color-ctp-blue) l c h / 0.3) 85%,
    transparent 100%
  );
}

/* Starfield section - always uses dark theme (Mocha) for cosmic background */
.starfield-section {
  /* Force Mocha colors in this section regardless of OS preference */
  --catppuccin-color-base: #1e1e2e;
  --catppuccin-color-mantle: #181825;
  --catppuccin-color-crust: #11111b;
  --catppuccin-color-text: #cdd6f4;
  --catppuccin-color-subtext1: #bac2de;
  --catppuccin-color-subtext0: #a6adc8;
  --catppuccin-color-overlay2: #9399b2;
  --catppuccin-color-overlay1: #7f849c;
  --catppuccin-color-overlay0: #6c7086;
  --catppuccin-color-surface2: #585b70;
  --catppuccin-color-surface1: #45475a;
  --catppuccin-color-surface0: #313244;
  --catppuccin-color-mauve: #cba6f7;
  --catppuccin-color-pink: #f5c2e7;
  --catppuccin-color-blue: #89b4fa;
  /* Background is transparent to let the canvas starfield show through */
  background-color: transparent;
  color: var(--catppuccin-color-text);
}
